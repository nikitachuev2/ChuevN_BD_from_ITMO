# Лабораторная работа 2

Чуев Никита  
Группа: p4150  
Дата выполнения задания: 15.03.2025  
Именование дисциплины: Взаимодействие с базами данных  

## Текст задания

1. Из описания предметной области, полученной в ходе выполнения ЛР 1, выделить сущности, их атрибуты и связи, отразить их в инфологической модели (она же концептуальная).
2. Составить даталогическую (она же ER-диаграмма, она же диаграмма сущность-связь) модель. При описании типов данных для атрибутов должны использоваться типы из СУБД PostgreSQL.
3. Реализовать даталогическую модель в PostgreSQL. При описании и реализации даталогической модели должны учитываться ограничения целостности, которые характерны для полученной предметной области.
4. Заполнить созданные таблицы тестовыми данными.
Для построения моделей можно использовать plantUML.

## Описание предметной области
Библиотека предоставляет читателям доступ к книгам и другим информационным ресурсам. Она обслуживает читателей, предоставляет возможность брать книги на абонемент и организует различные мероприятия.

## Список сущностей и их классификация
1. **Книги** (стержневая сущность)
   - ID книги (INTEGER, PRIMARY KEY)
   - Название книги (VARCHAR)
   - Автор (VARCHAR)
   - Жанр (VARCHAR)
   - Дата издания (DATE)
   - Количество экземпляров (INTEGER)

2. **Читатели** (стержневая сущность)
   - ID читателя (INTEGER, PRIMARY KEY)
   - Имя (VARCHAR)
   - Фамилия (VARCHAR)
   - Дата рождения (DATE)
   - Контактная информация (VARCHAR)
   - Дата регистрации (DATE)

3. **Абонементы** (ассоциационная сущность)
   - ID абонемента (INTEGER, PRIMARY KEY)
   - ID читателя (INTEGER, FOREIGN KEY)
   - ID книги (INTEGER, FOREIGN KEY)
   - Дата выдачи (DATE)
   - Дата возврата (DATE)
   - Статус (VARCHAR)

4. **Мероприятия** (стержневая сущность)
   - ID мероприятия (INTEGER, PRIMARY KEY)
   - Название мероприятия (VARCHAR)
   - Дата и время проведения (TIMESTAMP)
   - Описание мероприятия (TEXT)
   - Максимальное количество участников (INTEGER)

## Инфологическая модель (ER-диаграмма)

```plantuml
@startuml
entity "Книги" {
  + ID книги : INT <<PK>>
  + Название книги : VARCHAR
  + Автор : VARCHAR
  + Жанр : VARCHAR
  + Дата издания : DATE
  + Количество экземпляров : INT
}

entity "Читатели" {
  + ID читателя : INT <<PK>>
  + Имя : VARCHAR
  + Фамилия : VARCHAR
  + Дата рождения : DATE
  + Контактная информация : VARCHAR
  + Дата регистрации : DATE
}

entity "Абонементы" {
  + ID абонемента : INT <<PK>>
  + ID читателя : INT <<FK>>
  + ID книги : INT <<FK>>
  + Дата выдачи : DATE
  + Дата возврата : DATE
  + Статус : VARCHAR
}

entity "Мероприятия" {
  + ID мероприятия : INT <<PK>>
  + Название мероприятия : VARCHAR
  + Дата и время проведения : TIMESTAMP
  + Описание мероприятия : TEXT
  + Максимальное количество участников : INT
}

Книги ||--o{ Абонементы : "имеет"
Читатели ||--o{ Абонементы : "берет"
Читатели }o--o{ Мероприятия : "участвует"
@enduml

## Даталогическая модель
### Список таблиц
1. Книги

   CREATE TABLE books (book_id SERIAL PRIMARY KEY, title VARCHAR(255) NOT NULL, author VARCHAR(255) NOT NULL, genre VARCHAR(100), publication_date DATE, copies_count INTEGER NOT NULL CHECK (copies_count >= 0));

2. Читатели

CREATE TABLE readers (reader_id SERIAL PRIMARY KEY, first_name VARCHAR(100) NOT NULL, last_name VARCHAR(100) NOT NULL, birth_date DATE, contact_info VARCHAR(255), registration_date DATE DEFAULT CURRENT_DATE);

3. Абонементы

CREATE TABLE subscriptions (subscription_id SERIAL PRIMARY KEY, reader_id INT REFERENCES readers(reader_id) ON DELETE CASCADE, book_id INT REFERENCES books(book_id) ON DELETE CASCADE, issue_date DATE, return_date DATE, status VARCHAR(100) CHECK (status IN ('выдан', 'возвращен')));

4. Мероприятия

CREATE TABLE events (event_id SERIAL PRIMARY KEY, title VARCHAR(255) NOT NULL, date_time TIMESTAMP NOT NULL, description TEXT, max_participants INTEGER CHECK (max_participants > 0)); 

### Заполнение таблиц тестовыми данными

#### Описание добавленных тестовых данных

1. Тестовые данные для таблицы books (Книги):
   - Запись про 'Гарри Поттер':
     - Автор: Дж.K. Роулинг
     - Жанр: Фэнтези
     - Дата издания: 26 июня 1997 года
     - Количество экземпляров: 5
   - Запись про 'Война и мир':
     - Автор: Лев Толстой
     - Жанр: Исторический роман
     - Дата издания: 1 января 1869 года
     - Количество экземпляров: 3
   - Эти данные демонстрируют наличие книг в библиотеке: "Гарри Поттер" и "Война и мир" 

2. Тестовые данные для таблицы readers (Читатели):
   - Читатель 1: Чуев Никита, родился 22 сентября 2002 года, контактная информация: nikita@example.com
   - Читатель 2: Выдумкин Илья, родился 26 июля 1987 года, контактная информация: ilya@example.com
   - Эти данные показывают, что в библиотеке зарегистрированы два читателя, которые могут брать книги на абонемент.

3. Тестовые данные для таблицы subscriptions (Абонементы):
   - Абонемент 1 (Читатель 1 - Книга 1): Чуев Никита взял "Гарри Поттер" 1 января 2023 года.
   - Абонемент 2 (Читатель 2 - Книга 2): Выдумкин Илья взял "Война и мир" 2 января 2023 года.
   - Эти данные демонстрируют, как читатели используют библиотеку, задействуя абонементы на книги.

4. Тестовые данные для таблицы events (Мероприятия):
   - Мероприятие 1: Книжная ярмарка, собирающая 100 участников, дата и время - 15 марта 2025 года, 10:00.
   - Мероприятие 2: Литературный вечер, ожидается 50 участников, дата и время - 20 марта 2025 года, 19:00.
   - Эти данные показывают, что библиотека активно организует мероприятия, в которых могут участвовать читатели.

#### SQL-коды для вставки данных в каждую таблицу

-- Вставка данных в таблицу books
INSERT INTO books (title, author, genre, publication_date, copies_count) VALUES ('Гарри Поттер', 'Дж.K. Роулинг', 'Фэнтези', '1997-06-26', 5), ('Война и мир', 'Лев Толстой', 'Исторический роман', '1869-01-01', 3);

-- Вставка данных в таблицу readers
INSERT INTO readers (first_name, last_name, birth_date, contact_info) VALUES ('Чуев', 'Никита', '2002-09-22', 'nikita@example.com'), ('Выдумкин', 'Илья', '1987-07-26', 'ilya@example.com');

-- Вставка данных в таблицу subscriptions
INSERT INTO subscriptions (reader_id, book_id, issue_date, return_date, status) VALUES (1, 1, '2023-01-01', NULL, 'выдан'), (2, 2, '2023-01-02', NULL, 'выдан');

-- Вставка данных в таблицу events
INSERT INTO events (title, date_time, description, max_participants) 
VALUES 
    ('Книжная ярмарка', '2025-03-15 10:00:00', 'Ярмарка для любителей книг', 100), 
    ('Литературный вечер', '2025-03-20 19:00:00', 'Вечер поэзии и прозы', 50);
###  Запросы для проверки заполненных данных

#### SQL-запросы для проверки данных в таблицах:

-- Проверка данных в таблице books
SELECT * FROM books;

 book_id |    title     |    author     |       genre        | publication_date | copies_count 
---------+--------------+---------------+--------------------+------------------+--------------
       1 | Гарри Поттер | Дж.K. Роулинг | Фэнтези            | 1997-06-26       |            5
       2 | Война и мир  | Лев Толстой   | Исторический роман | 1869-01-01       |            3
(2 строки)

(END)

-- Проверка данных в таблице readers
SELECT * FROM readers;

 reader_id | first_name | last_name | birth_date |    contact_info    | registration_date 
-----------+------------+-----------+------------+--------------------+-------------------
         1 | Чуев       | Никита    | 2002-09-22 | nikita@example.com | 2025-03-14
         2 | Выдумкин   | Илья      | 1987-07-26 | ilya@example.com   | 2025-03-14
(2 строки)

(END)

-- Проверка данных в таблице subscriptions
SELECT * FROM subscriptions;

Вы подключены к базе данных "library" как пользователь "postgres".
library=# SELECT * FROM subscriptions;
 subscription_id | reader_id | book_id | issue_date | return_date | status 
-----------------+-----------+---------+------------+-------------+--------
               1 |         1 |       1 | 2023-01-01 |             | выдан
               2 |         2 |       2 | 2023-01-02 |             | выдан
(2 строки)

library=# 

-- Проверка данных в таблице events
SELECT * FROM events;

 event_id |       title        |      date_time      |        description         | max_participants 
----------+--------------------+---------------------+----------------------------+------------------
        1 | Книжная ярмарка    | 2025-03-15 10:00:00 | Ярмарка для любителей книг |              100
        2 | Литературный вечер | 2025-03-20 19:00:00 | Вечер поэзии и прозы       |               50
(2 строки)

(END)

